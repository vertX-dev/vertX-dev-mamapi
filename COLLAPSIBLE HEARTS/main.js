import { world, system } from "@minecraft:server";

const baseValues = {
    fadeIn: 1,
    stay: 75,
    fadeOut: 1
}

const healthBars = [
  ["","","","","","","","","","", "","","","","","","","","",""],
  ["","","","","","","","","","", "","","","","","","","","",""],
  ["","","","","","","","","","", "","","","","","","","","",""],
  ["","","","","","","","","","", "","","","","","","","","",""],
  ["","","","","","","","","","", "","","","","","","","","",""],
  ["","","","","","","","","","", "","","","","","","","","",""],
  ["","","","","","","","","","", "","","","","","","","","",""],
  ["","","","","","","","","","", "","","","","","","","","",""],
  ["","","","","","","","","","", "","","","","","","","","",""],
  ["","","","","","","","","","", "","","","","","","","","",""],
  ["","","","","","","","","","", "","","","","","","","","",""],
  ["","","","","","","","","","", "","","","","","","","","",""],
  ["","","","","","","","","","", "","","","","","","","","",""],
  ["","","","","","","","","","", "","","","","","","","","",""],
  ["","","","","","","","","","", "","","","","","","","","",""],
  ["","","","","","","","","","", "","","","","","","","","",""]
];


world.afterEvents.healthChanged.subscribe((ev) => {
    if (ev.entity.typeId != "minecraft:player") return;
    const player = ev.entity;
    
    const hpcomponent = player.getComponent("minecraft:health");
    const maxHp = hpcomponent.effectiveValue;
    const currentHp = ev.newValue;
    
    const col = currentHp % 20;
    const rowAbs = Math.floor(maxHp / 20);
    let row = rowAbs % 13;
    if (rowAbs > 13) row + 1;
    
    const fadeIn = getScoreboardValue("fadeIn", player) ?? baseValues.fadeIn;
    const stay = getScoreboardValue("stay", player) ?? baseValues.stay;
    const fadeOut= getScoreboardValue("fadeOut", player) ?? baseValues.fadeOut;
    
    
    player.runCommand("title @s times 0 0 0");
    player.onScreenDisplay();
    player.runCommand(`title @s times ${fadeIn} ${stay} ${fadeOut}`);
});